<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="balgil.com.trip.route">

	<resultMap id="RouteVOResultMap" type="balgil.com.trip.route.model.RouteVO">
	  <id property="id" column="id" />
	  <result property="route_name" column="route_name" />
	  <result property="img" column="img" />
	  <result property="summary" column="summary" />
	  <result property="seller_id" column="seller_id" />
	  <result property="dest_name" column="여행지" />
	  <result property="act_name1" column="루트1" />
	  <result property="act_name2" column="루트1" />
	  <result property="act_name3" column="루트3" />
	  <result property="act_name4" column="루트4" />
	  <result property="act_name5" column="루트5" />
	</resultMap>

	<select id="ROUTE_SELECT_ALL" resultMap="RouteVOResultMap">
		SELECT
			r.id,
			r.route_name,
			r.img,
			r.summary,
			r.seller_id,
			d."NAME" as 여행지,
			a1.act_name as 루트1,
			a2.act_name as 루트2,
			a3.act_name as 루트3,
			a4.act_name as 루트4,
			a5.act_name as 루트5
		FROM
			route r
			INNER JOIN destination d ON d.id = r.dest_id
			LEFT JOIN activity a1 ON a1.id = r.RT1
			LEFT JOIN activity a2 ON a2.id = r.RT2
			LEFT JOIN activity a3 ON a3.id = r.RT3
			LEFT JOIN activity a4 ON a4.id = r.RT4
			LEFT JOIN activity a5 ON a5.id = r.RT5
		WHERE
			r.seller_id = #{seller_id}
	</select>
	
	<!-- 
	설명은 밑 링크 참조
	https://github.com/kimsha1228/FinalProject/wiki/MyBatis-%EC%97%90%EC%84%9C-foreach-%ED%99%9C%EC%9A%A9 -->
	<insert id="ROUTE_INSERT" parameterType="balgil.com.trip.route.model.RouteVO">
	  INSERT INTO "ROUTE" ("ID", "ROUTE_NAME", "CONTENT", "IMG", "SUMMARY", "SELLER_ID", "DEST_ID"
		  <foreach item="rt" index="index" open=", " separator=", " close="" collection="rts">
		    "RT${index + 1}"
		  </foreach>
	  )
	  VALUES (SEQ_ROUTE.nextval, #{route_name}, #{content}, #{img}, #{summary}, #{seller_id}, #{dest_id}
		  <foreach item="rt" index="index" open=", " separator=", " close="" collection="rts">
		    #{rt}
		  </foreach>
	  )
	</insert>

	<update id="ROUTE_UPDATE" parameterType="balgil.com.trip.route.model.RouteVO">
		update ROUTE set ACT_NAME=#{act_name} , CONTENT=#{content} , 
				TAG=#{tag} , "ADD"=#{add}, DEST_ID=#{dest_id},
				PRICE=#{price}, ACT_DATE=SYSDATE
		where ID = #{id}
	</update>
	
	<update id="ROUTE_VCOUNTUP" parameterType="balgil.com.trip.route.model.RouteVO">
		update ROUTE set vcount=vcount+1
		where ID = #{id}
	</update>
	
	<delete id="ROUTE_DELETE">
		delete from ROUTE where id = #{id}
	</delete>
</mapper>